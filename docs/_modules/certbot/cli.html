

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>certbot.cli &mdash; Certbot 0.37.0.dev0 documentation</title>
  
<!--

 ██████╗███████╗██████╗ ████████╗██████╗  ██████╗ ████████╗
██╔════╝██╔════╝██╔══██╗╚══██╔══╝██╔══██╗██╔═══██╗╚══██╔══╝
██║     █████╗  ██████╔╝   ██║   ██████╔╝██║   ██║   ██║
██║     ██╔══╝  ██╔══██╗   ██║   ██╔══██╗██║   ██║   ██║
╚██████╗███████╗██║  ██║   ██║   ██████╔╝╚██████╔╝   ██║
 ╚═════╝╚══════╝╚═╝  ╚═╝   ╚═╝   ╚═════╝  ╚═════╝    ╚═╝

Like looking at code? Help us! https://github.com/certbot/certbot
-->

  
  

  <meta name="description" content="Automatically enable HTTPS on your website with EFF's Certbot, deploying Let's Encrypt certificates.">
<meta property="og:image" content="https://certbot.eff.org/images/certbot-OG.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@EFF">
<meta name="twitter:title" content="certbot.cli &mdash; Certbot 0.37.0.dev0 documentation">
<meta name="twitter:description" content="Automatically enable HTTPS on your website with EFF's Certbot, deploying Let's Encrypt certificates.">
<meta name="twitter:image" content="https://certbot.eff.org/images/certbot-OG.png">
<meta name="twitter:image:alt" content="Certbot: An automatic client for enabling HTTPS on your website.">

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Certbot 0.37.0.dev0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <nav class="main-nav fixed">
  <ul>
    <li><a href="/"><img src="/images/EFF-logo-plain.svg" alt="Electronic Frontier Foundation"></a></li>
    <li><a href="/">Home</a></li>
    <li><a href="/about/">About Certbot</a></li>
    <li><a href="/faq/">FAQ</a></li>
    <li><a href="/docs/">Documentation</a></li>
    <li><a href="/support/">Support</a></li>
    <li><a target="_blank" rel="noreferrer" href="https://github.com/certbot/certbot">Source Code</a></li>
    <li class="donate"><a target="_blank" href="https://supporters.eff.org/donate/support-work-on-certbot">donate to EFF</a></li>
    <li id="hamburger">&#x2261;</li>
  </ul>
</nav>

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../" class="icon icon-home"> Certbot
          

          
          </a>

          
            
            
              <div class="version">
                0.37
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../what.html">What is a Certificate?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Get Certbot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../using.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packaging.html">Packaging Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources.html">Resources</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../">Certbot</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          











<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
        <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>certbot.cli</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/certbot/certbot/blob/master/docs/_modules/certbot/cli" class="fa fa-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for certbot.cli</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Certbot command line argument &amp; config processing.&quot;&quot;&quot;</span>
<span class="c1"># pylint: disable=too-many-lines</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">logging.handlers</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">configargparse</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">zope.component</span>
<span class="kn">import</span> <span class="nn">zope.interface</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="k">import</span> <span class="n">interfaces</span> <span class="k">as</span> <span class="n">zope_interfaces</span>

<span class="kn">from</span> <span class="nn">acme</span> <span class="k">import</span> <span class="n">challenges</span>
<span class="c1"># pylint: disable=unused-import, no-name-in-module</span>
<span class="kn">from</span> <span class="nn">acme.magic_typing</span> <span class="k">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<span class="c1"># pylint: enable=unused-import, no-name-in-module</span>

<span class="kn">import</span> <span class="nn">certbot</span>
<span class="kn">import</span> <span class="nn">certbot.plugins.enhancements</span> <span class="k">as</span> <span class="nn">enhancements</span>
<span class="kn">import</span> <span class="nn">certbot.plugins.selection</span> <span class="k">as</span> <span class="nn">plugin_selection</span>
<span class="kn">from</span> <span class="nn">certbot</span> <span class="k">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">certbot</span> <span class="k">import</span> <span class="n">crypto_util</span>
<span class="kn">from</span> <span class="nn">certbot</span> <span class="k">import</span> <span class="n">errors</span>
<span class="kn">from</span> <span class="nn">certbot</span> <span class="k">import</span> <span class="n">hooks</span>
<span class="kn">from</span> <span class="nn">certbot</span> <span class="k">import</span> <span class="n">interfaces</span>
<span class="kn">from</span> <span class="nn">certbot</span> <span class="k">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">certbot.compat</span> <span class="k">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="nn">certbot.display</span> <span class="k">import</span> <span class="n">util</span> <span class="k">as</span> <span class="n">display_util</span>
<span class="kn">from</span> <span class="nn">certbot.plugins</span> <span class="k">import</span> <span class="n">disco</span> <span class="k">as</span> <span class="n">plugins_disco</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Global, to save us from a lot of argument passing within the scope of this module</span>
<span class="n">helpful_parser</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[HelpfulArgumentParser]</span>

<span class="c1"># For help strings, figure out how the user ran us.</span>
<span class="c1"># When invoked from letsencrypt-auto, sys.argv[0] is something like:</span>
<span class="c1"># &quot;/home/user/.local/share/certbot/bin/certbot&quot;</span>
<span class="c1"># Note that this won&#39;t work if the user set VENV_PATH or XDG_DATA_HOME before</span>
<span class="c1"># running letsencrypt-auto (and sudo stops us from seeing if they did), so it</span>
<span class="c1"># should only be used for purposes where inability to detect letsencrypt-auto</span>
<span class="c1"># fails safely</span>

<span class="n">LEAUTO</span> <span class="o">=</span> <span class="s2">&quot;letsencrypt-auto&quot;</span>
<span class="k">if</span> <span class="s2">&quot;CERTBOT_AUTO&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="c1"># if we&#39;re here, this is probably going to be certbot-auto, unless the</span>
    <span class="c1"># user saved the script under a different name</span>
    <span class="n">LEAUTO</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CERTBOT_AUTO&quot;</span><span class="p">])</span>

<span class="n">old_path_fragment</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;.local&quot;</span><span class="p">,</span> <span class="s2">&quot;share&quot;</span><span class="p">,</span> <span class="s2">&quot;letsencrypt&quot;</span><span class="p">)</span>
<span class="n">new_path_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="s2">&quot;opt&quot;</span><span class="p">,</span>
                                               <span class="s2">&quot;eff.org&quot;</span><span class="p">,</span> <span class="s2">&quot;certbot&quot;</span><span class="p">,</span> <span class="s2">&quot;venv&quot;</span><span class="p">))</span>
<span class="k">if</span> <span class="n">old_path_fragment</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">new_path_prefix</span><span class="p">):</span>
    <span class="n">cli_command</span> <span class="o">=</span> <span class="n">LEAUTO</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">cli_command</span> <span class="o">=</span> <span class="s2">&quot;certbot&quot;</span>

<span class="c1"># Argparse&#39;s help formatting has a lot of unhelpful peculiarities, so we want</span>
<span class="c1"># to replace as much of it as we can...</span>

<span class="c1"># This is the stub to include in help generated by argparse</span>
<span class="n">SHORT_USAGE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  </span><span class="si">{0}</span><span class="s2"> [SUBCOMMAND] [options] [-d DOMAIN] [-d DOMAIN] ...</span>

<span class="s2">Certbot can obtain and install HTTPS/TLS/SSL certificates.  By default,</span>
<span class="s2">it will attempt to use a webserver both for obtaining and installing the</span>
<span class="s2">certificate. &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cli_command</span><span class="p">)</span>

<span class="c1"># This section is used for --help and --help all ; it needs information</span>
<span class="c1"># about installed plugins to be fully formatted</span>
<span class="n">COMMAND_OVERVIEW</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The most common SUBCOMMANDS and flags are:</span>

<span class="s2">obtain, install, and renew certificates:</span>
<span class="s2">    (default) run   Obtain &amp; install a certificate in your current webserver</span>
<span class="s2">    certonly        Obtain or renew a certificate, but do not install it</span>
<span class="s2">    renew           Renew all previously obtained certificates that are near expiry</span>
<span class="s2">    enhance         Add security enhancements to your existing configuration</span>
<span class="s2">   -d DOMAINS       Comma-separated list of domains to obtain a certificate for</span>

<span class="s2">  </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">  --standalone      Run a standalone webserver for authentication</span>
<span class="s2">  </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">  --webroot         Place files in a server&#39;s webroot folder for authentication</span>
<span class="s2">  --manual          Obtain certificates interactively, or using shell script hooks</span>

<span class="s2">   -n               Run non-interactively</span>
<span class="s2">  --test-cert       Obtain a test certificate from a staging server</span>
<span class="s2">  --dry-run         Test &quot;renew&quot; or &quot;certonly&quot; without saving any certificates to disk</span>

<span class="s2">manage certificates:</span>
<span class="s2">    certificates    Display information about certificates you have from Certbot</span>
<span class="s2">    revoke          Revoke a certificate (supply --cert-path or --cert-name)</span>
<span class="s2">    delete          Delete a certificate</span>

<span class="s2">manage your account:</span>
<span class="s2">    register        Create an ACME account</span>
<span class="s2">    unregister      Deactivate an ACME account</span>
<span class="s2">    update_account  Update an ACME account</span>
<span class="s2">  --agree-tos       Agree to the ACME server&#39;s Subscriber Agreement</span>
<span class="s2">   -m EMAIL         Email address for important account notifications</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># This is the short help for certbot --help, where we disable argparse</span>
<span class="c1"># altogether</span>
<span class="n">HELP_AND_VERSION_USAGE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">More detailed help:</span>

<span class="s2">  -h, --help [TOPIC]    print this message, or detailed help on a topic;</span>
<span class="s2">                        the available TOPICS are:</span>

<span class="s2">   all, automation, commands, paths, security, testing, or any of the</span>
<span class="s2">   subcommands or plugins (certonly, renew, install, register, nginx,</span>
<span class="s2">   apache, standalone, webroot, etc.)</span>
<span class="s2">  -h all                print a detailed help page including all topics </span>
<span class="s2">  --version             print the version number</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="c1"># These argparse parameters should be removed when detecting defaults.</span>
<span class="n">ARGPARSE_PARAMS_TO_REMOVE</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;const&quot;</span><span class="p">,</span> <span class="s2">&quot;nargs&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,)</span>


<span class="c1"># These sets are used when to help detect options set by the user.</span>
<span class="n">EXIT_ACTIONS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;help&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">,))</span>


<span class="n">ZERO_ARG_ACTIONS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span> <span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="s2">&quot;append_const&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,))</span>


<span class="c1"># Maps a config option to a set of config options that may have modified it.</span>
<span class="c1"># This dictionary is used recursively, so if A modifies B and B modifies C,</span>
<span class="c1"># it is determined that C was modified by the user if A was modified.</span>
<span class="n">VAR_MODIFIERS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;server&quot;</span><span class="p">,)),</span>
                 <span class="s2">&quot;renew_hook&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;deploy_hook&quot;</span><span class="p">,)),</span>
                 <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;dry_run&quot;</span><span class="p">,</span> <span class="s2">&quot;staging&quot;</span><span class="p">,)),</span>
                 <span class="s2">&quot;webroot_map&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">((</span><span class="s2">&quot;webroot_path&quot;</span><span class="p">,))}</span>


<div class="viewcode-block" id="report_config_interaction"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.report_config_interaction">[docs]</a><span class="k">def</span> <span class="nf">report_config_interaction</span><span class="p">(</span><span class="n">modified</span><span class="p">,</span> <span class="n">modifiers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Registers config option interaction to be checked by set_by_cli.</span>

<span class="sd">    This function can be called by during the __init__ or</span>
<span class="sd">    add_parser_arguments methods of plugins to register interactions</span>
<span class="sd">    between config options.</span>

<span class="sd">    :param modified: config options that can be modified by modifiers</span>
<span class="sd">    :type modified: iterable or str (string_types)</span>
<span class="sd">    :param modifiers: config options that modify modified</span>
<span class="sd">    :type modifiers: iterable or str (string_types)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modified</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">modified</span> <span class="o">=</span> <span class="p">(</span><span class="n">modified</span><span class="p">,)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modifiers</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">modifiers</span> <span class="o">=</span> <span class="p">(</span><span class="n">modifiers</span><span class="p">,)</span>

    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">modified</span><span class="p">:</span>
        <span class="n">VAR_MODIFIERS</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">modifiers</span><span class="p">)</span></div>


<div class="viewcode-block" id="possible_deprecation_warning"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.possible_deprecation_warning">[docs]</a><span class="k">def</span> <span class="nf">possible_deprecation_warning</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="s2">&quot;A deprecation warning for users with the old, not-self-upgrading letsencrypt-auto.&quot;</span>
    <span class="k">if</span> <span class="n">cli_command</span> <span class="o">!=</span> <span class="n">LEAUTO</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">no_self_upgrade</span><span class="p">:</span>
        <span class="c1"># users setting --no-self-upgrade might be hanging on a client version like 0.3.0</span>
        <span class="c1"># or 0.5.0 which is the new script, but doesn&#39;t set CERTBOT_AUTO; they don&#39;t</span>
        <span class="c1"># need warnings</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="s2">&quot;CERTBOT_AUTO&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;You are running with an old copy of letsencrypt-auto&quot;</span>
            <span class="s2">&quot; that does not receive updates, and is less reliable than more&quot;</span>
            <span class="s2">&quot; recent versions. The letsencrypt client has also been renamed&quot;</span>
            <span class="s2">&quot; to Certbot. We recommend upgrading to the latest certbot-auto&quot;</span>
            <span class="s2">&quot; script, or using native OS packages.&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Deprecation warning circumstances: </span><span class="si">%s</span><span class="s2"> / </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span></div>


<div class="viewcode-block" id="_Default"><a class="viewcode-back" href="../../api/cli.html#certbot.cli._Default">[docs]</a><span class="k">class</span> <span class="nc">_Default</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class to use as a default to detect if a value is set by a user&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_Default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="n">_Default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__bool__</span><span class="p">()</span></div>


<div class="viewcode-block" id="set_by_cli"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.set_by_cli">[docs]</a><span class="k">def</span> <span class="nf">set_by_cli</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return True if a particular config variable has been set by the user</span>
<span class="sd">    (CLI or config file) including if the user explicitly set it to the</span>
<span class="sd">    default.  Returns False if the variable was assigned a default value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">detector</span> <span class="o">=</span> <span class="n">set_by_cli</span><span class="o">.</span><span class="n">detector</span>  <span class="c1"># type: ignore</span>
    <span class="k">if</span> <span class="n">detector</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">helpful_parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Setup on first run: `detector` is a weird version of config in which</span>
        <span class="c1"># the default value of every attribute is wrangled to be boolean-false</span>
        <span class="n">plugins</span> <span class="o">=</span> <span class="n">plugins_disco</span><span class="o">.</span><span class="n">PluginsRegistry</span><span class="o">.</span><span class="n">find_all</span><span class="p">()</span>
        <span class="c1"># reconstructed_args == sys.argv[1:], or whatever was passed to main()</span>
        <span class="n">reconstructed_args</span> <span class="o">=</span> <span class="n">helpful_parser</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="p">[</span><span class="n">helpful_parser</span><span class="o">.</span><span class="n">verb</span><span class="p">]</span>
        <span class="n">detector</span> <span class="o">=</span> <span class="n">set_by_cli</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="n">prepare_and_parse_args</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
            <span class="n">plugins</span><span class="p">,</span> <span class="n">reconstructed_args</span><span class="p">,</span> <span class="n">detect_defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># propagate plugin requests: eg --standalone modifies config.authenticator</span>
        <span class="n">detector</span><span class="o">.</span><span class="n">authenticator</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">installer</span> <span class="o">=</span> <span class="p">(</span>  <span class="c1"># type: ignore</span>
            <span class="n">plugin_selection</span><span class="o">.</span><span class="n">cli_plugin_requests</span><span class="p">(</span><span class="n">detector</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">detector</span><span class="p">,</span> <span class="n">var</span><span class="p">),</span> <span class="n">_Default</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Var </span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2"> (set by user).&quot;</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">detector</span><span class="p">,</span> <span class="n">var</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">VAR_MODIFIERS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="k">if</span> <span class="n">set_by_cli</span><span class="p">(</span><span class="n">modifier</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Var </span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2"> (set by user).&quot;</span><span class="p">,</span>
                <span class="n">var</span><span class="p">,</span> <span class="n">VAR_MODIFIERS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="p">[]))</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span></div>

<span class="c1"># static housekeeping var</span>
<span class="c1"># functions attributed are not supported by mypy</span>
<span class="c1"># https://github.com/python/mypy/issues/2087</span>
<span class="n">set_by_cli</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>


<div class="viewcode-block" id="has_default_value"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.has_default_value">[docs]</a><span class="k">def</span> <span class="nf">has_default_value</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Does option have the default value?</span>

<span class="sd">    If the default value of option is not known, False is returned.</span>

<span class="sd">    :param str option: configuration variable being considered</span>
<span class="sd">    :param value: value of the configuration variable named option</span>

<span class="sd">    :returns: True if option has the default value, otherwise, False</span>
<span class="sd">    :rtype: bool</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">helpful_parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">option</span> <span class="ow">in</span> <span class="n">helpful_parser</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">and</span>
                <span class="n">helpful_parser</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="n">option</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="option_was_set"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.option_was_set">[docs]</a><span class="k">def</span> <span class="nf">option_was_set</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Was option set by the user or does it differ from the default?</span>

<span class="sd">    :param str option: configuration variable being considered</span>
<span class="sd">    :param value: value of the configuration variable named option</span>

<span class="sd">    :returns: True if the option was set, otherwise, False</span>
<span class="sd">    :rtype: bool</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">set_by_cli</span><span class="p">(</span><span class="n">option</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_default_value</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="argparse_type"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.argparse_type">[docs]</a><span class="k">def</span> <span class="nf">argparse_type</span><span class="p">(</span><span class="n">variable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return our argparse type function for a config variable (default: str)&quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=protected-access</span>
    <span class="k">if</span> <span class="n">helpful_parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">helpful_parser</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span> <span class="o">==</span> <span class="n">variable</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span>
    <span class="k">return</span> <span class="nb">str</span></div>

<div class="viewcode-block" id="read_file"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.read_file">[docs]</a><span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the given file&#39;s contents.</span>

<span class="sd">    :param str filename: path to file</span>
<span class="sd">    :param str mode: open mode (see `open`)</span>

<span class="sd">    :returns: absolute path of filename and its contents</span>
<span class="sd">    :rtype: tuple</span>

<span class="sd">    :raises argparse.ArgumentTypeError: File does not exist or is not readable.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">the_file</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">the_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">filename</span><span class="p">,</span> <span class="n">contents</span>
    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentTypeError</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">strerror</span><span class="p">)</span></div>


<div class="viewcode-block" id="flag_default"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.flag_default">[docs]</a><span class="k">def</span> <span class="nf">flag_default</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Default value for CLI flag.&quot;&quot;&quot;</span>
    <span class="c1"># XXX: this is an internal housekeeping notion of defaults before</span>
    <span class="c1"># argparse has been set up; it is not accurate for all flags.  Call it</span>
    <span class="c1"># with caution.  Plugin defaults are missing, and some things are using</span>
    <span class="c1"># defaults defined in this file, not in constants.py :(</span>
    <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">CLI_DEFAULTS</span><span class="p">[</span><span class="n">name</span><span class="p">])</span></div>


<div class="viewcode-block" id="config_help"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.config_help">[docs]</a><span class="k">def</span> <span class="nf">config_help</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract the help message for an `.IConfig` attribute.&quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=no-member</span>
    <span class="k">if</span> <span class="n">hidden</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">interfaces</span><span class="o">.</span><span class="n">IConfig</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># type: zope.interface.interface.Attribute  # pylint: disable=no-value-for-parameter</span>
    <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="vm">__doc__</span></div>


<div class="viewcode-block" id="HelpfulArgumentGroup"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentGroup">[docs]</a><span class="k">class</span> <span class="nc">HelpfulArgumentGroup</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Emulates an argparse group for use with HelpfulArgumentParser.</span>

<span class="sd">    This class is used in the add_group method of HelpfulArgumentParser.</span>
<span class="sd">    Command line arguments can be added to the group, but help</span>
<span class="sd">    suppression and default detection is applied by</span>
<span class="sd">    HelpfulArgumentParser when necessary.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">helpful_arg_parser</span><span class="p">,</span> <span class="n">topic</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span> <span class="o">=</span> <span class="n">helpful_arg_parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_topic</span> <span class="o">=</span> <span class="n">topic</span>

<div class="viewcode-block" id="HelpfulArgumentGroup.add_argument"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentGroup.add_argument">[docs]</a>    <span class="k">def</span> <span class="nf">add_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a new command line argument to the argument group.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_topic</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="CustomHelpFormatter"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.CustomHelpFormatter">[docs]</a><span class="k">class</span> <span class="nc">CustomHelpFormatter</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">HelpFormatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a clone of ArgumentDefaultsHelpFormatter, with bugfixes.</span>

<span class="sd">    In particular we fix https://bugs.python.org/issue28742</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_help_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">helpstr</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span>
        <span class="k">if</span> <span class="s1">&#39;%(default)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span> <span class="ow">and</span> <span class="s1">&#39;(default:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span> <span class="o">!=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">:</span>
                <span class="n">defaulting_nargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">argparse</span><span class="o">.</span><span class="n">OPTIONAL</span><span class="p">,</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ZERO_OR_MORE</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span> <span class="ow">or</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="ow">in</span> <span class="n">defaulting_nargs</span><span class="p">:</span>
                    <span class="n">helpstr</span> <span class="o">+=</span> <span class="s1">&#39; (default: </span><span class="si">%(default)s</span><span class="s1">)&#39;</span>
        <span class="k">return</span> <span class="n">helpstr</span></div>

<span class="c1"># The attributes here are:</span>
<span class="c1"># short: a string that will be displayed by &quot;certbot -h commands&quot;</span>
<span class="c1"># opts:  a string that heads the section of flags with which this command is documented,</span>
<span class="c1">#        both for &quot;certbot -h SUBCOMMAND&quot; and &quot;certbot -h all&quot;</span>
<span class="c1"># usage: an optional string that overrides the header of &quot;certbot -h SUBCOMMAND&quot;</span>
<span class="n">VERB_HELP</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;run (default)&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Obtain/renew a certificate, and install it&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="s2">&quot;Options for obtaining &amp; installing certificates&quot;</span><span class="p">,</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="n">SHORT_USAGE</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[SUBCOMMAND]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="s2">&quot;realname&quot;</span><span class="p">:</span> <span class="s2">&quot;run&quot;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Obtain or renew a certificate, but do not install it&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="s2">&quot;Options for modifying how a certificate is obtained&quot;</span><span class="p">,</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot certonly [options] [-d DOMAIN] [-d DOMAIN] ...</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;This command obtains a TLS/SSL certificate without installing it anywhere.&quot;</span><span class="p">)</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Renew all certificates (or one specified with --cert-name)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;The &#39;renew&#39; subcommand will attempt to renew all&quot;</span>
                 <span class="s2">&quot; certificates (or more precisely, certificate lineages) you have&quot;</span>
                 <span class="s2">&quot; previously obtained if they are close to expiry, and print a&quot;</span>
                 <span class="s2">&quot; summary of the results. By default, &#39;renew&#39; will reuse the options&quot;</span>
                 <span class="s2">&quot; used to create obtain or most recently successfully renew each&quot;</span>
                 <span class="s2">&quot; certificate lineage. You can try it with `--dry-run` first. For&quot;</span>
                 <span class="s2">&quot; more fine-grained control, you can renew individual lineages with&quot;</span>
                 <span class="s2">&quot; the `certonly` subcommand. Hooks are available to run commands&quot;</span>
                 <span class="s2">&quot; before and after renewal; see&quot;</span>
                 <span class="s2">&quot; https://certbot.eff.org/docs/using.html#renewal for more&quot;</span>
                 <span class="s2">&quot; information on these.&quot;</span><span class="p">),</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot renew [--cert-name CERTNAME] [options]</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;certificates&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;List certificates managed by Certbot&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="s2">&quot;List certificates managed by Certbot&quot;</span><span class="p">,</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot certificates [options] ...</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;Print information about the status of certificates managed by Certbot.&quot;</span><span class="p">)</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Clean up all files related to a certificate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="s2">&quot;Options for deleting a certificate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot delete --cert-name CERTNAME</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;revoke&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Revoke a certificate specified with --cert-path or --cert-name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="s2">&quot;Options for revocation of certificates&quot;</span><span class="p">,</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot revoke [--cert-path /path/to/fullchain.pem | &quot;</span>
        <span class="s2">&quot;--cert-name example.com] [options]</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Register for account with Let&#39;s Encrypt / other ACME server&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="s2">&quot;Options for account registration&quot;</span><span class="p">,</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot register --email user@example.com [options]</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;update_account&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Update existing account with Let&#39;s Encrypt / other ACME server&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="s2">&quot;Options for account modification&quot;</span><span class="p">,</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot update_account --email updated_email@example.com [options]</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;unregister&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Irrevocably deactivate your account&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="s2">&quot;Options for account deactivation.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot unregister [options]</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Install an arbitrary certificate in a server&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="s2">&quot;Options for modifying how a certificate is deployed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot install --cert-path /path/to/fullchain.pem &quot;</span>
        <span class="s2">&quot; --key-path /path/to/private-key [options]</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;config_changes&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Show changes that Certbot has made to server configurations&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="s2">&quot;Options for viewing configuration changes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot config_changes [options]</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;rollback&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Roll back server conf changes made during certificate installation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="s2">&quot;Options for rolling back server configuration changes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot rollback --checkpoints 3 [options]</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;List plugins that are installed and available on your system&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="s1">&#39;Options for the &quot;plugins&quot; subcommand&#39;</span><span class="p">,</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot plugins [options]</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;update_symlinks&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Recreate symlinks in your /etc/letsencrypt/live/ directory&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Recreates certificate and key symlinks in </span><span class="si">{0}</span><span class="s2">, if you changed them by hand &quot;</span>
                 <span class="s2">&quot;or edited a renewal configuration file&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;config_dir&quot;</span><span class="p">),</span> <span class="s2">&quot;live&quot;</span><span class="p">))),</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot update_symlinks [options]</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;enhance&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;short&quot;</span><span class="p">:</span> <span class="s2">&quot;Add security enhancements to your existing configuration&quot;</span><span class="p">,</span>
        <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Helps to harden the TLS configuration by adding security enhancements &quot;</span>
                 <span class="s2">&quot;to already existing configuration.&quot;</span><span class="p">),</span>
        <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  certbot enhance [options]</span><span class="se">\n\n</span><span class="s2">&quot;</span>
    <span class="p">}),</span>

<span class="p">]</span>
<span class="c1"># VERB_HELP is a list in order to preserve order, but a dict is sometimes useful</span>
<span class="n">VERB_HELP_MAP</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">VERB_HELP</span><span class="p">)</span>


<div class="viewcode-block" id="HelpfulArgumentParser"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser">[docs]</a><span class="k">class</span> <span class="nc">HelpfulArgumentParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Argparse Wrapper.</span>

<span class="sd">    This class wraps argparse, adding the ability to make --help less</span>
<span class="sd">    verbose, and request help on specific subcategories at a time, eg</span>
<span class="sd">    &#39;certbot --help security&#39; for security options.</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">plugins</span><span class="p">,</span> <span class="n">detect_defaults</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">certbot</span> <span class="k">import</span> <span class="n">main</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VERBS</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;auth&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">certonly</span><span class="p">,</span>
            <span class="s2">&quot;certonly&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">certonly</span><span class="p">,</span>
            <span class="s2">&quot;config_changes&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">config_changes</span><span class="p">,</span>
            <span class="s2">&quot;run&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">run</span><span class="p">,</span>
            <span class="s2">&quot;install&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">install</span><span class="p">,</span>
            <span class="s2">&quot;plugins&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">plugins_cmd</span><span class="p">,</span>
            <span class="s2">&quot;register&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">register</span><span class="p">,</span>
            <span class="s2">&quot;update_account&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">update_account</span><span class="p">,</span>
            <span class="s2">&quot;unregister&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">unregister</span><span class="p">,</span>
            <span class="s2">&quot;renew&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">renew</span><span class="p">,</span>
            <span class="s2">&quot;revoke&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">revoke</span><span class="p">,</span>
            <span class="s2">&quot;rollback&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">rollback</span><span class="p">,</span>
            <span class="s2">&quot;everything&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">run</span><span class="p">,</span>
            <span class="s2">&quot;update_symlinks&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">update_symlinks</span><span class="p">,</span>
            <span class="s2">&quot;certificates&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">certificates</span><span class="p">,</span>
            <span class="s2">&quot;delete&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">delete</span><span class="p">,</span>
            <span class="s2">&quot;enhance&quot;</span><span class="p">:</span> <span class="n">main</span><span class="o">.</span><span class="n">enhance</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Get notification function for printing</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify</span> <span class="o">=</span> <span class="n">zope</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">getUtility</span><span class="p">(</span>
                <span class="n">interfaces</span><span class="o">.</span><span class="n">IDisplay</span><span class="p">)</span><span class="o">.</span><span class="n">notification</span>
        <span class="k">except</span> <span class="n">zope_interfaces</span><span class="o">.</span><span class="n">ComponentLookupError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify</span> <span class="o">=</span> <span class="n">display_util</span><span class="o">.</span><span class="n">NoninteractiveDisplay</span><span class="p">(</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">notification</span>


        <span class="c1"># List of topics for which additional help can be provided</span>
        <span class="n">HELP_TOPICS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">]</span>
        <span class="n">HELP_TOPICS</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VERBS</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMMANDS_TOPICS</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;manage&quot;</span><span class="p">]</span>

        <span class="n">plugin_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">plugins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_topics</span> <span class="o">=</span> <span class="n">HELP_TOPICS</span> <span class="o">+</span> <span class="n">plugin_names</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>  <span class="c1"># type: ignore</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">detect_defaults</span> <span class="o">=</span> <span class="n">detect_defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;help&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;--help&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">determine_verb</span><span class="p">()</span>
        <span class="n">help1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prescan_for_flag</span><span class="p">(</span><span class="s2">&quot;-h&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_topics</span><span class="p">)</span>
        <span class="n">help2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prescan_for_flag</span><span class="p">(</span><span class="s2">&quot;--help&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_topics</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">help1</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">help2</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help_arg</span> <span class="o">=</span> <span class="n">help1</span> <span class="ow">or</span> <span class="n">help2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help_arg</span> <span class="o">=</span> <span class="n">help1</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">help1</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span> <span class="k">else</span> <span class="n">help2</span>

        <span class="n">short_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_usage_string</span><span class="p">(</span><span class="n">plugins</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_arg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visible_topics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_help_topics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_arg</span><span class="p">)</span>

        <span class="c1"># elements are added by .add_group()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, argparse._ArgumentGroup]</span>
        <span class="c1"># elements are added by .parse_args()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, Any]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">configargparse</span><span class="o">.</span><span class="n">ArgParser</span><span class="p">(</span>
            <span class="n">prog</span><span class="o">=</span><span class="s2">&quot;certbot&quot;</span><span class="p">,</span>
            <span class="n">usage</span><span class="o">=</span><span class="n">short_usage</span><span class="p">,</span>
            <span class="n">formatter_class</span><span class="o">=</span><span class="n">CustomHelpFormatter</span><span class="p">,</span>
            <span class="n">args_for_setting_config_path</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;--config&quot;</span><span class="p">],</span>
            <span class="n">default_config_files</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;config_files&quot;</span><span class="p">),</span>
            <span class="n">config_arg_help_message</span><span class="o">=</span><span class="s2">&quot;path to config file (default: </span><span class="si">{0}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;config_files&quot;</span><span class="p">))))</span>

        <span class="c1"># This is the only way to turn off overly verbose config flag documentation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_add_config_file_help</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># pylint: disable=protected-access</span>

    <span class="c1"># Help that are synonyms for --help subcommands</span>
    <span class="n">COMMANDS_TOPICS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="s2">&quot;commands&quot;</span><span class="p">,</span> <span class="s2">&quot;subcommand&quot;</span><span class="p">,</span> <span class="s2">&quot;subcommands&quot;</span><span class="p">,</span> <span class="s2">&quot;verbs&quot;</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">_list_subcommands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">longest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">VERB_HELP_MAP</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;The full list of available SUBCOMMANDS is:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">verb</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">VERB_HELP</span><span class="p">):</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;short&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;{0:&lt;</span><span class="si">{length}</span><span class="s1">}     </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">longest</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You can get more help on a specific subcommand with --help SUBCOMMAND</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">text</span>

<div class="viewcode-block" id="HelpfulArgumentParser._usage_string"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser._usage_string">[docs]</a>    <span class="k">def</span> <span class="nf">_usage_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugins</span><span class="p">,</span> <span class="n">help_arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make usage strings late so that plugins can be initialised late</span>

<span class="sd">        :param plugins: all discovered plugins</span>
<span class="sd">        :param help_arg: False for none; True for --help; &quot;TOPIC&quot; for --help TOPIC</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :returns: a short usage string for the top of --help TOPIC)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;nginx&quot;</span> <span class="ow">in</span> <span class="n">plugins</span><span class="p">:</span>
            <span class="n">nginx_doc</span> <span class="o">=</span> <span class="s2">&quot;--nginx           Use the Nginx plugin for authentication &amp; installation&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nginx_doc</span> <span class="o">=</span> <span class="s2">&quot;(the certbot nginx plugin is not installed)&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;apache&quot;</span> <span class="ow">in</span> <span class="n">plugins</span><span class="p">:</span>
            <span class="n">apache_doc</span> <span class="o">=</span> <span class="s2">&quot;--apache          Use the Apache plugin for authentication &amp; installation&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">apache_doc</span> <span class="o">=</span> <span class="s2">&quot;(the certbot apache plugin is not installed)&quot;</span>

        <span class="n">usage</span> <span class="o">=</span> <span class="n">SHORT_USAGE</span>
        <span class="k">if</span> <span class="n">help_arg</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">usage</span> <span class="o">+</span> <span class="n">COMMAND_OVERVIEW</span> <span class="o">%</span> <span class="p">(</span><span class="n">apache_doc</span><span class="p">,</span> <span class="n">nginx_doc</span><span class="p">)</span> <span class="o">+</span> <span class="n">HELP_AND_VERSION_USAGE</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">help_arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMMANDS_TOPICS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">usage</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_subcommands</span><span class="p">())</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">help_arg</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="c1"># if we&#39;re doing --help all, the OVERVIEW is part of the SHORT_USAGE at</span>
            <span class="c1"># the top; if we&#39;re doing --help someothertopic, it&#39;s OT so it&#39;s not</span>
            <span class="n">usage</span> <span class="o">+=</span> <span class="n">COMMAND_OVERVIEW</span> <span class="o">%</span> <span class="p">(</span><span class="n">apache_doc</span><span class="p">,</span> <span class="n">nginx_doc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">custom</span> <span class="o">=</span> <span class="n">VERB_HELP_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">help_arg</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;usage&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="n">custom</span> <span class="k">if</span> <span class="n">custom</span> <span class="k">else</span> <span class="n">usage</span>

        <span class="k">return</span> <span class="n">usage</span></div>

<div class="viewcode-block" id="HelpfulArgumentParser.remove_config_file_domains_for_renewal"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser.remove_config_file_domains_for_renewal">[docs]</a>    <span class="k">def</span> <span class="nf">remove_config_file_domains_for_renewal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parsed_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make &quot;certbot renew&quot; safe if domains are set in cli.ini.&quot;&quot;&quot;</span>
        <span class="c1"># Works around https://github.com/certbot/certbot/issues/4096</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verb</span> <span class="o">==</span> <span class="s2">&quot;renew&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">flags</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_source_to_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="c1"># pylint: disable=protected-access</span>
                <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;config_file&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;domains&quot;</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
                    <span class="n">parsed_args</span><span class="o">.</span><span class="n">domains</span> <span class="o">=</span> <span class="n">_Default</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_defaults</span> <span class="k">else</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="HelpfulArgumentParser.parse_args"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser.parse_args">[docs]</a>    <span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parses command line arguments and returns the result.</span>

<span class="sd">        :returns: parsed command line arguments</span>
<span class="sd">        :rtype: argparse.Namespace</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">parsed_args</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERBS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">verb</span><span class="p">]</span>
        <span class="n">parsed_args</span><span class="o">.</span><span class="n">verb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verb</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">remove_config_file_domains_for_renewal</span><span class="p">(</span><span class="n">parsed_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_defaults</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parsed_args</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
                             <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">parsed_args</span><span class="p">))</span>

        <span class="c1"># Do any post-parsing homework here</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verb</span> <span class="o">==</span> <span class="s2">&quot;renew&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">force_interactive</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> cannot be used with renew&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">constants</span><span class="o">.</span><span class="n">FORCE_INTERACTIVE_FLAG</span><span class="p">))</span>
            <span class="n">parsed_args</span><span class="o">.</span><span class="n">noninteractive_mode</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">force_interactive</span> <span class="ow">and</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">noninteractive_mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span>
                <span class="s2">&quot;Flag for non-interactive mode and </span><span class="si">{0}</span><span class="s2"> conflict&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">constants</span><span class="o">.</span><span class="n">FORCE_INTERACTIVE_FLAG</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">staging</span> <span class="ow">or</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">dry_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_test_server</span><span class="p">(</span><span class="n">parsed_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">csr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_csr</span><span class="p">(</span><span class="n">parsed_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">must_staple</span><span class="p">:</span>
            <span class="n">parsed_args</span><span class="o">.</span><span class="n">staple</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">validate_hooks</span><span class="p">:</span>
            <span class="n">hooks</span><span class="o">.</span><span class="n">validate_hooks</span><span class="p">(</span><span class="n">parsed_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">allow_subset_of_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">is_wildcard_domain</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">domains</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Using --allow-subset-of-names with a&quot;</span>
                                   <span class="s2">&quot; wildcard domain is not supported.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">hsts</span> <span class="ow">and</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">auto_hsts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span>
                <span class="s2">&quot;Parameters --hsts and --auto-hsts cannot be used simultaneously.&quot;</span><span class="p">)</span>

        <span class="n">possible_deprecation_warning</span><span class="p">(</span><span class="n">parsed_args</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parsed_args</span></div>

<div class="viewcode-block" id="HelpfulArgumentParser.set_test_server"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser.set_test_server">[docs]</a>    <span class="k">def</span> <span class="nf">set_test_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parsed_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;We have --staging/--dry-run; perform sanity check and set config.server&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">server</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;server&quot;</span><span class="p">),</span> <span class="n">constants</span><span class="o">.</span><span class="n">STAGING_URI</span><span class="p">):</span>
            <span class="n">conflicts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;--staging&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">staging</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="n">conflicts</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;--dry-run&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">dry_run</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s2">&quot;--server value conflicts with </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conflicts</span><span class="p">)))</span>

        <span class="n">parsed_args</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">STAGING_URI</span>

        <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">dry_run</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verb</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;renew&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s2">&quot;--dry-run currently only works with the &quot;</span>
                                   <span class="s2">&quot;&#39;certonly&#39; or &#39;renew&#39; subcommands (</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">verb</span><span class="p">)</span>
            <span class="n">parsed_args</span><span class="o">.</span><span class="n">break_my_certs</span> <span class="o">=</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">staging</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">config_dir</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">ACCOUNTS_DIR</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)):</span>
                <span class="c1"># The user has a prod account, but might not have a staging</span>
                <span class="c1"># one; we don&#39;t want to start trying to perform interactive registration</span>
                <span class="n">parsed_args</span><span class="o">.</span><span class="n">tos</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">parsed_args</span><span class="o">.</span><span class="n">register_unsafely_without_email</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HelpfulArgumentParser.handle_csr"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser.handle_csr">[docs]</a>    <span class="k">def</span> <span class="nf">handle_csr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parsed_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process a --csr flag.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">verb</span> <span class="o">!=</span> <span class="s2">&quot;certonly&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Currently, a CSR file may only be specified &quot;</span>
                               <span class="s2">&quot;when obtaining a new or replacement &quot;</span>
                               <span class="s2">&quot;via the certonly command. Please try the &quot;</span>
                               <span class="s2">&quot;certonly command instead.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">allow_subset_of_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s2">&quot;--allow-subset-of-names cannot be used with --csr&quot;</span><span class="p">)</span>

        <span class="n">csrfile</span><span class="p">,</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">csr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">typ</span><span class="p">,</span> <span class="n">csr</span><span class="p">,</span> <span class="n">domains</span> <span class="o">=</span> <span class="n">crypto_util</span><span class="o">.</span><span class="n">import_csr_file</span><span class="p">(</span><span class="n">csrfile</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>

        <span class="c1"># This is not necessary for webroot to work, however,</span>
        <span class="c1"># obtain_certificate_from_csr requires parsed_args.domains to be set</span>
        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span>
            <span class="n">add_domains</span><span class="p">(</span><span class="n">parsed_args</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">domains</span><span class="p">:</span>
            <span class="c1"># TODO: add CN to domains instead:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span>
                <span class="s2">&quot;Unfortunately, your CSR </span><span class="si">%s</span><span class="s2"> needs to have a SubjectAltName for every domain&quot;</span>
                <span class="o">%</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">csr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">parsed_args</span><span class="o">.</span><span class="n">actual_csr</span> <span class="o">=</span> <span class="p">(</span><span class="n">csr</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>

        <span class="n">csr_domains</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">d</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">])</span>
        <span class="n">config_domains</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">domains</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">csr_domains</span> <span class="o">!=</span> <span class="n">config_domains</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;Inconsistent domain requests:</span><span class="se">\n</span><span class="s2">From the CSR: </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">From command line/config: </span><span class="si">{1}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csr_domains</span><span class="p">),</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_domains</span><span class="p">)))</span></div>


<div class="viewcode-block" id="HelpfulArgumentParser.determine_verb"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser.determine_verb">[docs]</a>    <span class="k">def</span> <span class="nf">determine_verb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determines the verb/subcommand provided by the user.</span>

<span class="sd">        This function works around some of the limitations of argparse.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;-h&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="ow">or</span> <span class="s2">&quot;--help&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="c1"># all verbs double as help arguments; don&#39;t get them confused</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verb</span> <span class="o">=</span> <span class="s2">&quot;help&quot;</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERBS</span><span class="p">:</span>
                <span class="n">verb</span> <span class="o">=</span> <span class="n">token</span>
                <span class="k">if</span> <span class="n">verb</span> <span class="o">==</span> <span class="s2">&quot;auth&quot;</span><span class="p">:</span>
                    <span class="n">verb</span> <span class="o">=</span> <span class="s2">&quot;certonly&quot;</span>
                <span class="k">if</span> <span class="n">verb</span> <span class="o">==</span> <span class="s2">&quot;everything&quot;</span><span class="p">:</span>
                    <span class="n">verb</span> <span class="o">=</span> <span class="s2">&quot;run&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verb</span> <span class="o">=</span> <span class="n">verb</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verb</span> <span class="o">=</span> <span class="s2">&quot;run&quot;</span></div>

<div class="viewcode-block" id="HelpfulArgumentParser.prescan_for_flag"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser.prescan_for_flag">[docs]</a>    <span class="k">def</span> <span class="nf">prescan_for_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">possible_arguments</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks cli input for flags.</span>

<span class="sd">        Check for a flag, which accepts a fixed set of possible arguments, in</span>
<span class="sd">        the command line; we will use this information to configure argparse&#39;s</span>
<span class="sd">        help correctly.  Return the flag&#39;s argument, if it has one that matches</span>
<span class="sd">        the sequence @possible_arguments; otherwise return whether the flag is</span>
<span class="sd">        present.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nxt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">nxt</span> <span class="ow">in</span> <span class="n">possible_arguments</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">nxt</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="HelpfulArgumentParser.add"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topics</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a new command line argument.</span>

<span class="sd">        :param topics: str or [str] help topic(s) this should be listed under,</span>
<span class="sd">                       or None for options that don&#39;t fit under a specific</span>
<span class="sd">                       topic which will only be shown in &quot;--help all&quot; output.</span>
<span class="sd">                       The first entry determines where the flag lives in the</span>
<span class="sd">                       &quot;--help all&quot; output (None -&gt; &quot;optional arguments&quot;).</span>
<span class="sd">        :param list *args: the names of this argument flag</span>
<span class="sd">        :param dict **kwargs: various argparse settings for this argument</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">topics</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># if this flag can be listed in multiple sections, try to pick the one</span>
            <span class="c1"># that the user has asked for help about</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_arg</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_arg</span> <span class="ow">in</span> <span class="n">topics</span> <span class="k">else</span> <span class="n">topics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="n">topics</span>  <span class="c1"># there&#39;s only one</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_defaults</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modify_kwargs_for_default_detection</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_topics</span><span class="p">[</span><span class="n">topic</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="HelpfulArgumentParser.modify_kwargs_for_default_detection"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser.modify_kwargs_for_default_detection">[docs]</a>    <span class="k">def</span> <span class="nf">modify_kwargs_for_default_detection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Modify an arg so we can check if it was set by the user.</span>

<span class="sd">        Changes the parameters given to argparse when adding an argument</span>
<span class="sd">        so we can properly detect if the value was set by the user.</span>

<span class="sd">        :param dict kwargs: various argparse settings for this argument</span>

<span class="sd">        :returns: a modified versions of kwargs</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">EXIT_ACTIONS</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;store_true&quot;</span> <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">ZERO_ARG_ACTIONS</span> <span class="k">else</span>
                                <span class="s2">&quot;store&quot;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_Default</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">ARGPARSE_PARAMS_TO_REMOVE</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">kwargs</span></div>

<div class="viewcode-block" id="HelpfulArgumentParser.add_deprecated_argument"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser.add_deprecated_argument">[docs]</a>    <span class="k">def</span> <span class="nf">add_deprecated_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument_name</span><span class="p">,</span> <span class="n">num_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a deprecated argument with the name argument_name.</span>

<span class="sd">        Deprecated arguments are not shown in the help. If they are used</span>
<span class="sd">        on the command line, a warning is shown stating that the</span>
<span class="sd">        argument is deprecated and no other action is taken.</span>

<span class="sd">        :param str argument_name: Name of deprecated argument.</span>
<span class="sd">        :param int nargs: Number of arguments the option takes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_deprecated_argument</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">,</span> <span class="n">argument_name</span><span class="p">,</span> <span class="n">num_args</span><span class="p">)</span></div>

<div class="viewcode-block" id="HelpfulArgumentParser.add_group"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser.add_group">[docs]</a>    <span class="k">def</span> <span class="nf">add_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">verbs</span><span class="o">=</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new argument group.</span>

<span class="sd">        This method must be called once for every topic, however, calls</span>
<span class="sd">        to this function are left next to the argument definitions for</span>
<span class="sd">        clarity.</span>

<span class="sd">        :param str topic: Name of the new argument group.</span>
<span class="sd">        :param str verbs: List of subcommands that should be documented as part of</span>
<span class="sd">                          this help group / topic</span>

<span class="sd">        :returns: The new argument group.</span>
<span class="sd">        :rtype: `HelpfulArgumentGroup`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_topics</span><span class="p">[</span><span class="n">topic</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_arg</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">verbs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">VERB_HELP_MAP</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;short&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">HelpfulArgumentGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">)</span></div>

<div class="viewcode-block" id="HelpfulArgumentParser.add_plugin_args"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser.add_plugin_args">[docs]</a>    <span class="k">def</span> <span class="nf">add_plugin_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugins</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Let each of the plugins add its own command line arguments, which</span>
<span class="sd">        may or may not be displayed as help topics.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">plugin_ep</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">plugins</span><span class="p">):</span>
            <span class="n">parser_or_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>
                                             <span class="n">description</span><span class="o">=</span><span class="n">plugin_ep</span><span class="o">.</span><span class="n">long_description</span><span class="p">)</span>
            <span class="n">plugin_ep</span><span class="o">.</span><span class="n">plugin_cls</span><span class="o">.</span><span class="n">inject_parser_options</span><span class="p">(</span><span class="n">parser_or_group</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="HelpfulArgumentParser.determine_help_topics"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.HelpfulArgumentParser.determine_help_topics">[docs]</a>    <span class="k">def</span> <span class="nf">determine_help_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chosen_topic</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        The user may have requested help on a topic, return a dict of which</span>
<span class="sd">        topics to display. @chosen_topic has prescan_for_flag&#39;s return type</span>

<span class="sd">        :returns: dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># topics maps each topic to whether it should be documented by</span>
        <span class="c1"># argparse on the command line</span>
        <span class="k">if</span> <span class="n">chosen_topic</span> <span class="o">==</span> <span class="s2">&quot;auth&quot;</span><span class="p">:</span>
            <span class="n">chosen_topic</span> <span class="o">=</span> <span class="s2">&quot;certonly&quot;</span>
        <span class="k">if</span> <span class="n">chosen_topic</span> <span class="o">==</span> <span class="s2">&quot;everything&quot;</span><span class="p">:</span>
            <span class="n">chosen_topic</span> <span class="o">=</span> <span class="s2">&quot;run&quot;</span>
        <span class="k">if</span> <span class="n">chosen_topic</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="c1"># Addition of condition closes #6209 (removal of duplicate route53 option).</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">t</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="s1">&#39;certbot-route53:auth&#39;</span> <span class="k">else</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_topics</span><span class="p">])</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">chosen_topic</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">t</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_topics</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span> <span class="o">==</span> <span class="n">chosen_topic</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_topics</span><span class="p">])</span></div></div>

<span class="k">def</span> <span class="nf">_add_all_groups</span><span class="p">(</span><span class="n">helpful</span><span class="p">):</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Flags for automating execution &amp; other tweaks&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Security parameters &amp; server settings&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="s2">&quot;testing&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The following flags are meant for testing and integration purposes only.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Flags for changing execution paths &amp; servers&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="s2">&quot;manage&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Various subcommands and flags are available for managing your certificates:&quot;</span><span class="p">,</span>
        <span class="n">verbs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;certificates&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;revoke&quot;</span><span class="p">,</span> <span class="s2">&quot;update_symlinks&quot;</span><span class="p">])</span>

    <span class="c1"># VERBS</span>
    <span class="k">for</span> <span class="n">verb</span><span class="p">,</span> <span class="n">docs</span> <span class="ow">in</span> <span class="n">VERB_HELP</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">docs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;realname&quot;</span><span class="p">,</span> <span class="n">verb</span><span class="p">)</span>
        <span class="n">helpful</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">docs</span><span class="p">[</span><span class="s2">&quot;opts&quot;</span><span class="p">])</span>


<div class="viewcode-block" id="prepare_and_parse_args"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.prepare_and_parse_args">[docs]</a><span class="k">def</span> <span class="nf">prepare_and_parse_args</span><span class="p">(</span><span class="n">plugins</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">detect_defaults</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># pylint: disable=too-many-statements</span>
    <span class="sd">&quot;&quot;&quot;Returns parsed command line arguments.</span>

<span class="sd">    :param .PluginsRegistry plugins: available plugins</span>
<span class="sd">    :param list args: command line arguments with the program name removed</span>

<span class="sd">    :returns: parsed command line arguments</span>
<span class="sd">    :rtype: argparse.Namespace</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=too-many-statements</span>

    <span class="n">helpful</span> <span class="o">=</span> <span class="n">HelpfulArgumentParser</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">plugins</span><span class="p">,</span> <span class="n">detect_defaults</span><span class="p">)</span>
    <span class="n">_add_all_groups</span><span class="p">(</span><span class="n">helpful</span><span class="p">)</span>

    <span class="c1"># --help is automatically provided by argparse</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose_count&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;verbose_count&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;This flag can be used &quot;</span>
        <span class="s2">&quot;multiple times to incrementally increase the verbosity of output, &quot;</span>
        <span class="s2">&quot;e.g. -vvv.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="s2">&quot;--text&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;text_mode&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;text_mode&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--max-log-backups&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">nonnegative_int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;max_log_backups&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specifies the maximum number of backup logs that should &quot;</span>
             <span class="s2">&quot;be kept by Certbot&#39;s built in log rotation. Setting this &quot;</span>
             <span class="s2">&quot;flag to 0 disables log rotation entirely, causing &quot;</span>
             <span class="s2">&quot;Certbot to always append to the same log file.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;enhance&quot;</span><span class="p">],</span>
        <span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;--non-interactive&quot;</span><span class="p">,</span> <span class="s2">&quot;--noninteractive&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;noninteractive_mode&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;noninteractive_mode&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run without ever asking for user input. This may require &quot;</span>
              <span class="s2">&quot;additional command line flags; the client will try to explain &quot;</span>
              <span class="s2">&quot;which ones are required if it finds one missing&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;enhance&quot;</span><span class="p">],</span>
        <span class="n">constants</span><span class="o">.</span><span class="n">FORCE_INTERACTIVE_FLAG</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;force_interactive&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Force Certbot to be interactive even if it detects it&#39;s not &quot;</span>
             <span class="s2">&quot;being run in a terminal. This flag cannot be used with the &quot;</span>
             <span class="s2">&quot;renew subcommand.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;certificates&quot;</span><span class="p">,</span> <span class="s2">&quot;enhance&quot;</span><span class="p">],</span>
        <span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="s2">&quot;--domains&quot;</span><span class="p">,</span> <span class="s2">&quot;--domain&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;domains&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;DOMAIN&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">_DomainsAction</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;domains&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Domain names to apply. For multiple domains you can use &quot;</span>
             <span class="s2">&quot;multiple -d flags or enter a comma separated list of domains &quot;</span>
             <span class="s2">&quot;as a parameter. The first domain provided will be the &quot;</span>
             <span class="s2">&quot;subject CN of the certificate, and all domains will be &quot;</span>
             <span class="s2">&quot;Subject Alternative Names on the certificate. &quot;</span>
             <span class="s2">&quot;The first domain will also be used in &quot;</span>
             <span class="s2">&quot;some software user interfaces and as the file paths for the &quot;</span>
             <span class="s2">&quot;certificate and related material unless otherwise &quot;</span>
             <span class="s2">&quot;specified or you already have a certificate with the same &quot;</span>
             <span class="s2">&quot;name. In the case of a name collision it will append a number &quot;</span>
             <span class="s2">&quot;like 0001 to the file path name. (default: Ask)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;register&quot;</span><span class="p">],</span>
        <span class="s2">&quot;--eab-kid&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;eab_kid&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;EAB_KID&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Key Identifier for External Account Binding&quot;</span>
    <span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;register&quot;</span><span class="p">],</span>
        <span class="s2">&quot;--eab-hmac-key&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;eab_hmac_key&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;EAB_HMAC_KEY&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;HMAC key for External Account Binding&quot;</span>
    <span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;manage&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;certificates&quot;</span><span class="p">,</span>
         <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;enhance&quot;</span><span class="p">],</span> <span class="s2">&quot;--cert-name&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;certname&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;CERTNAME&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;certname&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Certificate name to apply. This name is used by Certbot for housekeeping &quot;</span>
             <span class="s2">&quot;and in file paths; it doesn&#39;t affect the content of the certificate itself. &quot;</span>
             <span class="s2">&quot;To see certificate names, run &#39;certbot certificates&#39;. &quot;</span>
             <span class="s2">&quot;When creating a new certificate, specifies the new certificate&#39;s name. &quot;</span>
             <span class="s2">&quot;(default: the first provided domain or the name of an existing &quot;</span>
             <span class="s2">&quot;certificate on your system for the same domains)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span>
        <span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;dry_run&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dry_run&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Perform a test run of the client, obtaining test (invalid) certificates&quot;</span>
             <span class="s2">&quot; but not saving them to disk. This can currently only be used&quot;</span>
             <span class="s2">&quot; with the &#39;certonly&#39; and &#39;renew&#39; subcommands. </span><span class="se">\n</span><span class="s2">Note: Although --dry-run&quot;</span>
             <span class="s2">&quot; tries to avoid making any persistent changes on a system, it &quot;</span>
             <span class="s2">&quot; is not completely side-effect free: if used with webserver authenticator plugins&quot;</span>
             <span class="s2">&quot; like apache and nginx, it makes and then reverts temporary config changes&quot;</span>
             <span class="s2">&quot; in order to obtain test certificates, and reloads webservers to deploy and then&quot;</span>
             <span class="s2">&quot; roll back those changes.  It also calls --pre-hook and --post-hook commands&quot;</span>
             <span class="s2">&quot; if they are defined because they may be necessary to accurately simulate&quot;</span>
             <span class="s2">&quot; renewal. --deploy-hook commands are not called.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="s2">&quot;automation&quot;</span><span class="p">],</span> <span class="s2">&quot;--register-unsafely-without-email&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;register_unsafely_without_email&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specifying this flag enables registering an account with no &quot;</span>
             <span class="s2">&quot;email address. This is strongly discouraged, because in the &quot;</span>
             <span class="s2">&quot;event of key loss or account compromise you will irrevocably &quot;</span>
             <span class="s2">&quot;lose access to your account. You will also be unable to receive &quot;</span>
             <span class="s2">&quot;notice about impending expiration or revocation of your &quot;</span>
             <span class="s2">&quot;certificates. Updates to the Subscriber Agreement will still &quot;</span>
             <span class="s2">&quot;affect you, and will be effective 14 days after posting an &quot;</span>
             <span class="s2">&quot;update to the web site.&quot;</span><span class="p">)</span>
    <span class="c1"># TODO: When `certbot register --update-registration` is fully deprecated,</span>
    <span class="c1"># delete following helpful.add</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="s2">&quot;--update-registration&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;update_registration&quot;</span><span class="p">),</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;update_registration&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="s2">&quot;update_account&quot;</span><span class="p">,</span> <span class="s2">&quot;unregister&quot;</span><span class="p">,</span> <span class="s2">&quot;automation&quot;</span><span class="p">],</span> <span class="s2">&quot;-m&quot;</span><span class="p">,</span> <span class="s2">&quot;--email&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="n">config_help</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="s2">&quot;update_account&quot;</span><span class="p">,</span> <span class="s2">&quot;automation&quot;</span><span class="p">],</span> <span class="s2">&quot;--eff-email&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;eff_email&quot;</span><span class="p">),</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;eff_email&quot;</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Share your e-mail address with EFF&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="s2">&quot;update_account&quot;</span><span class="p">,</span> <span class="s2">&quot;automation&quot;</span><span class="p">],</span> <span class="s2">&quot;--no-eff-email&quot;</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;eff_email&quot;</span><span class="p">),</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;eff_email&quot;</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Don&#39;t share your e-mail address with EFF&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">],</span>
        <span class="s2">&quot;--keep-until-expiring&quot;</span><span class="p">,</span> <span class="s2">&quot;--keep&quot;</span><span class="p">,</span> <span class="s2">&quot;--reinstall&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;reinstall&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;reinstall&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;If the requested certificate matches an existing certificate, always keep the &quot;</span>
             <span class="s2">&quot;existing one until it is due for renewal (for the &quot;</span>
             <span class="s2">&quot;&#39;run&#39; subcommand this means reinstall the existing certificate). (default: Ask)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;--expand&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;expand&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;If an existing certificate is a strict subset of the requested names, &quot;</span>
             <span class="s2">&quot;always expand and replace it with the additional names. (default: Ask)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;version&quot;</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(prog)s</span><span class="s2"> </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">certbot</span><span class="o">.</span><span class="n">__version__</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;show program&#39;s version number and exit&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;renew&quot;</span><span class="p">],</span>
        <span class="s2">&quot;--force-renewal&quot;</span><span class="p">,</span> <span class="s2">&quot;--renew-by-default&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;renew_by_default&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;renew_by_default&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;If a certificate &quot;</span>
             <span class="s2">&quot;already exists for the requested domains, renew it now, &quot;</span>
             <span class="s2">&quot;regardless of whether it is near expiry. (Often &quot;</span>
             <span class="s2">&quot;--keep-until-expiring is more appropriate). Also implies &quot;</span>
             <span class="s2">&quot;--expand.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;--renew-with-new-domains&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;renew_with_new_domains&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;renew_with_new_domains&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;If a &quot;</span>
             <span class="s2">&quot;certificate already exists for the requested certificate name &quot;</span>
             <span class="s2">&quot;but does not match the requested domains, renew it now, &quot;</span>
             <span class="s2">&quot;regardless of whether it is near expiry.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;--reuse-key&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;reuse_key&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;reuse_key&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;When renewing, use the same private key as the existing &quot;</span>
             <span class="s2">&quot;certificate.&quot;</span><span class="p">)</span>

    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span>
        <span class="s2">&quot;--allow-subset-of-names&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;allow_subset_of_names&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;When performing domain validation, do not consider it a failure &quot;</span>
             <span class="s2">&quot;if authorizations can not be obtained for a strict subset of &quot;</span>
             <span class="s2">&quot;the requested domains. This may be useful for allowing renewals for &quot;</span>
             <span class="s2">&quot;multiple domains to succeed even if some domains no longer point &quot;</span>
             <span class="s2">&quot;at this system. This option cannot be used with --csr.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;--agree-tos&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;tos&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;tos&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Agree to the ACME Subscriber Agreement (default: Ask)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;unregister&quot;</span><span class="p">,</span> <span class="s2">&quot;automation&quot;</span><span class="p">],</span> <span class="s2">&quot;--account&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;ACCOUNT_ID&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;account&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Account ID to use&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;--duplicate&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;duplicate&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;duplicate&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Allow making a certificate lineage that duplicates an existing one &quot;</span>
             <span class="s2">&quot;(both can be renewed in parallel)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;--os-packages-only&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;os_packages_only&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;(certbot-auto only) install OS package dependencies and then stop&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-self-upgrade&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;no_self_upgrade&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;(certbot-auto only) prevent the certbot-auto script from&quot;</span>
             <span class="s2">&quot; upgrading itself to newer released versions (default: Upgrade&quot;</span>
             <span class="s2">&quot; automatically)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-bootstrap&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;no_bootstrap&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;(certbot-auto only) prevent the certbot-auto script from&quot;</span>
             <span class="s2">&quot; installing OS-level dependencies (default: Prompt to install &quot;</span>
             <span class="s2">&quot; OS-wide dependencies, but exit if the user says &#39;No&#39;)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-permissions-check&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;no_permissions_check&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;(certbot-auto only) skip the check on the file system&quot;</span>
             <span class="s2">&quot; permissions of the certbot-auto script&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">],</span>
        <span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;quiet&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;quiet&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Silence all output except errors. Useful for automation via cron.&quot;</span>
             <span class="s2">&quot; Implies --non-interactive.&quot;</span><span class="p">)</span>
    <span class="c1"># overwrites server, handled in HelpfulArgumentParser.parse_args()</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="s2">&quot;revoke&quot;</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">],</span> <span class="s2">&quot;--test-cert&quot;</span><span class="p">,</span> <span class="s2">&quot;--staging&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;staging&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;staging&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use the staging server to obtain or revoke test (invalid) certificates; equivalent&quot;</span>
             <span class="s2">&quot; to --server &quot;</span> <span class="o">+</span> <span class="n">constants</span><span class="o">.</span><span class="n">STAGING_URI</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="s2">&quot;--debug&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show tracebacks in case of errors, and allow certbot-auto &quot;</span>
             <span class="s2">&quot;execution on experimental platforms&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">],</span> <span class="s2">&quot;--debug-challenges&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;debug_challenges&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;After setting up challenges, wait for user input before &quot;</span>
             <span class="s2">&quot;submitting to CA&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-verify-ssl&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">config_help</span><span class="p">(</span><span class="s2">&quot;no_verify_ssl&quot;</span><span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;no_verify_ssl&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="s2">&quot;standalone&quot;</span><span class="p">,</span> <span class="s2">&quot;manual&quot;</span><span class="p">],</span> <span class="s2">&quot;--http-01-port&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;http01_port&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;http01_port&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="n">config_help</span><span class="p">(</span><span class="s2">&quot;http01_port&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="s2">&quot;standalone&quot;</span><span class="p">],</span> <span class="s2">&quot;--http-01-address&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;http01_address&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;http01_address&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="n">config_help</span><span class="p">(</span><span class="s2">&quot;http01_address&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="s2">&quot;nginx&quot;</span><span class="p">],</span> <span class="s2">&quot;--https-port&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;https_port&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="n">config_help</span><span class="p">(</span><span class="s2">&quot;https_port&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="s2">&quot;--break-my-certs&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;break_my_certs&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Be willing to replace or renew valid certificates with invalid &quot;</span>
             <span class="s2">&quot;(testing/staging) certificates&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="s2">&quot;--rsa-key-size&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;rsa_key_size&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="n">config_help</span><span class="p">(</span><span class="s2">&quot;rsa_key_size&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="s2">&quot;--must-staple&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;must_staple&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;must_staple&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="n">config_help</span><span class="p">(</span><span class="s2">&quot;must_staple&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="s2">&quot;enhance&quot;</span><span class="p">],</span>
        <span class="s2">&quot;--redirect&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;redirect&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;redirect&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Automatically redirect all HTTP traffic to HTTPS for the newly &quot;</span>
             <span class="s2">&quot;authenticated vhost. (default: Ask)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-redirect&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;redirect&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;redirect&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not automatically redirect all HTTP traffic to HTTPS for the newly &quot;</span>
             <span class="s2">&quot;authenticated vhost. (default: Ask)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="s2">&quot;enhance&quot;</span><span class="p">],</span>
        <span class="s2">&quot;--hsts&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;hsts&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;hsts&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Add the Strict-Transport-Security header to every HTTP response.&quot;</span>
             <span class="s2">&quot; Forcing browser to always use SSL for the domain.&quot;</span>
             <span class="s2">&quot; Defends against SSL Stripping.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-hsts&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;hsts&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;hsts&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="s2">&quot;enhance&quot;</span><span class="p">],</span>
        <span class="s2">&quot;--uir&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;uir&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;uir&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Add the &quot;Content-Security-Policy: upgrade-insecure-requests&quot;&#39;</span>
             <span class="s1">&#39; header to every HTTP response. Forcing the browser to use&#39;</span>
             <span class="s1">&#39; https:// for every http:// resource.&#39;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-uir&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;uir&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;uir&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="s2">&quot;--staple-ocsp&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;staple&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;staple&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enables OCSP Stapling. A valid OCSP response is stapled to&quot;</span>
        <span class="s2">&quot; the certificate that the server offers during TLS.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-staple-ocsp&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;staple&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;staple&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;security&quot;</span><span class="p">,</span> <span class="s2">&quot;--strict-permissions&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;strict_permissions&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Require that all configuration files are owned by the current &quot;</span>
             <span class="s2">&quot;user; only needed if your config is somewhere unsafe like /tmp/&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;manual&quot;</span><span class="p">,</span> <span class="s2">&quot;standalone&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;renew&quot;</span><span class="p">],</span>
        <span class="s2">&quot;--preferred-challenges&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pref_challs&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="n">_PrefChallAction</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;pref_challs&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;A sorted, comma delimited list of the preferred challenge to &#39;</span>
             <span class="s1">&#39;use during authorization with the most preferred challenge &#39;</span>
             <span class="s1">&#39;listed first (Eg, &quot;dns&quot; or &quot;http,dns&quot;). &#39;</span>
             <span class="s1">&#39;Not all plugins support all challenges. See &#39;</span>
             <span class="s1">&#39;https://certbot.eff.org/docs/using.html#plugins for details. &#39;</span>
             <span class="s1">&#39;ACME Challenges are versioned, but if you pick &quot;http&quot; rather &#39;</span>
             <span class="s1">&#39;than &quot;http-01&quot;, Certbot will select the latest version &#39;</span>
             <span class="s1">&#39;automatically.&#39;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;--pre-hook&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Command to be run in a shell before obtaining any certificates.&quot;</span>
        <span class="s2">&quot; Intended primarily for renewal, where it can be used to temporarily&quot;</span>
        <span class="s2">&quot; shut down a webserver that might conflict with the standalone&quot;</span>
        <span class="s2">&quot; plugin. This will only be called if a certificate is actually to be&quot;</span>
        <span class="s2">&quot; obtained/renewed. When renewing several certificates that have&quot;</span>
        <span class="s2">&quot; identical pre-hooks, only the first will be executed.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;--post-hook&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Command to be run in a shell after attempting to obtain/renew&quot;</span>
        <span class="s2">&quot; certificates. Can be used to deploy renewed certificates, or to&quot;</span>
        <span class="s2">&quot; restart any servers that were stopped by --pre-hook. This is only&quot;</span>
        <span class="s2">&quot; run if an attempt was made to obtain/renew a certificate. If&quot;</span>
        <span class="s2">&quot; multiple renewed certificates have identical post-hooks, only&quot;</span>
        <span class="s2">&quot; one will be run.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;--renew-hook&quot;</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="n">_RenewHookAction</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-random-sleep-on-renew&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;random_sleep_on_renew&quot;</span><span class="p">),</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;random_sleep_on_renew&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;--deploy-hook&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">_DeployHookAction</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Command to be run in a shell once for each successfully&#39;</span>
        <span class="s1">&#39; issued certificate. For this command, the shell variable&#39;</span>
        <span class="s1">&#39; $RENEWED_LINEAGE will point to the config live subdirectory&#39;</span>
        <span class="s1">&#39; (for example, &quot;/etc/letsencrypt/live/example.com&quot;) containing&#39;</span>
        <span class="s1">&#39; the new certificates and keys; the shell variable&#39;</span>
        <span class="s1">&#39; $RENEWED_DOMAINS will contain a space-delimited list of&#39;</span>
        <span class="s1">&#39; renewed certificate domains (for example, &quot;example.com&#39;</span>
        <span class="s1">&#39; www.example.com&quot;&#39;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;--disable-hook-validation&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;validate_hooks&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;validate_hooks&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Ordinarily the commands specified for&quot;</span>
        <span class="s2">&quot; --pre-hook/--post-hook/--deploy-hook will be checked for&quot;</span>
        <span class="s2">&quot; validity, to see if the programs being run are in the $PATH,&quot;</span>
        <span class="s2">&quot; so that mistakes can be caught early, even when the hooks&quot;</span>
        <span class="s2">&quot; aren&#39;t being run just yet. The validation is rather&quot;</span>
        <span class="s2">&quot; simplistic and fails if you use more advanced shell&quot;</span>
        <span class="s2">&quot; constructs, so you can use this switch to disable it.&quot;</span>
        <span class="s2">&quot; (default: False)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-directory-hooks&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;directory_hooks&quot;</span><span class="p">),</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;directory_hooks&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable running executables found in Certbot&#39;s hook directories&quot;</span>
        <span class="s2">&quot; during renewal. (default: False)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;--disable-renew-updates&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;disable_renew_updates&quot;</span><span class="p">),</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;disable_renew_updates&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable automatic updates to your server configuration that&quot;</span>
        <span class="s2">&quot; would otherwise be done by the selected installer plugin, and triggered&quot;</span>
        <span class="s2">&quot; when the user executes </span><span class="se">\&quot;</span><span class="s2">certbot renew</span><span class="se">\&quot;</span><span class="s2">, regardless of if the certificate&quot;</span>
        <span class="s2">&quot; is renewed. This setting does not apply to important TLS configuration&quot;</span>
        <span class="s2">&quot; updates.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;renew&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-autorenew&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;autorenew&quot;</span><span class="p">),</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;autorenew&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable auto renewal of certificates.&quot;</span><span class="p">)</span>

    <span class="n">helpful</span><span class="o">.</span><span class="n">add_deprecated_argument</span><span class="p">(</span><span class="s2">&quot;--agree-dev-preview&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add_deprecated_argument</span><span class="p">(</span><span class="s2">&quot;--dialog&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Deprecation of tls-sni-01 related cli flags</span>
    <span class="c1"># TODO: remove theses flags completely in few releases</span>
    <span class="k">class</span> <span class="nc">_DeprecatedTLSSNIAction</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">_ShowWarning</span><span class="p">):</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">_DeprecatedTLSSNIAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="p">)</span>
            <span class="n">namespace</span><span class="o">.</span><span class="n">https_port</span> <span class="o">=</span> <span class="n">values</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="s2">&quot;standalone&quot;</span><span class="p">,</span> <span class="s2">&quot;apache&quot;</span><span class="p">,</span> <span class="s2">&quot;nginx&quot;</span><span class="p">],</span> <span class="s2">&quot;--tls-sni-01-port&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">_DeprecatedTLSSNIAction</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add_deprecated_argument</span><span class="p">(</span><span class="s2">&quot;--tls-sni-01-address&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Populate the command line parameters for new style enhancements</span>
    <span class="n">enhancements</span><span class="o">.</span><span class="n">populate_cli</span><span class="p">(</span><span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>

    <span class="n">_create_subparsers</span><span class="p">(</span><span class="n">helpful</span><span class="p">)</span>
    <span class="n">_paths_parser</span><span class="p">(</span><span class="n">helpful</span><span class="p">)</span>
    <span class="c1"># _plugins_parsing should be the last thing to act upon the main</span>
    <span class="c1"># parser (--help should display plugin-specific options last)</span>
    <span class="n">_plugins_parsing</span><span class="p">(</span><span class="n">helpful</span><span class="p">,</span> <span class="n">plugins</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">detect_defaults</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">helpful_parser</span> <span class="c1"># pylint: disable=global-statement</span>
        <span class="n">helpful_parser</span> <span class="o">=</span> <span class="n">helpful</span>
    <span class="k">return</span> <span class="n">helpful</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span></div>


<span class="k">def</span> <span class="nf">_create_subparsers</span><span class="p">(</span><span class="n">helpful</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">certbot.client</span> <span class="k">import</span> <span class="n">sample_user_agent</span> <span class="c1"># avoid import loops</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--user-agent&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;user_agent&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Set a custom user agent string for the client. User agent strings allow &#39;</span>
             <span class="s1">&#39;the CA to collect high level statistics about success rates by OS, &#39;</span>
             <span class="s1">&#39;plugin and use case, and to know when to deprecate support for past Python &#39;</span>
             <span class="s2">&quot;versions and flags. If you wish to hide this information from the Let&#39;s &quot;</span>
             <span class="s1">&#39;Encrypt server, set this to &quot;&quot;. &#39;</span>
             <span class="s1">&#39;(default: </span><span class="si">{0}</span><span class="s1">). The flags encoded in the user agent are: &#39;</span>
             <span class="s1">&#39;--duplicate, --force-renew, --allow-subset-of-names, -n, and &#39;</span>
             <span class="s1">&#39;whether any hooks are set.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample_user_agent</span><span class="p">()))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;--user-agent-comment&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;user_agent_comment&quot;</span><span class="p">),</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">_user_agent_comment_type</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Add a comment to the default user agent string. May be used when repackaging Certbot &quot;</span>
             <span class="s2">&quot;or calling it from another tool to allow additional statistical data to be collected.&quot;</span>
             <span class="s2">&quot; Ignored if --user-agent is set. (Example: Foo-Wrapper/1.0)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;certonly&quot;</span><span class="p">,</span>
                <span class="s2">&quot;--csr&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;csr&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="n">read_file</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to a Certificate Signing Request (CSR) in DER or PEM format.&quot;</span>
                <span class="s2">&quot; Currently --csr only works with the &#39;certonly&#39; subcommand.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;revoke&quot;</span><span class="p">,</span>
                <span class="s2">&quot;--reason&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;reason&quot;</span><span class="p">,</span>
                <span class="n">choices</span><span class="o">=</span><span class="n">CaseInsensitiveList</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">REVOCATION_REASONS</span><span class="p">,</span>
                                                   <span class="n">key</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">REVOCATION_REASONS</span><span class="o">.</span><span class="n">get</span><span class="p">)),</span>
                <span class="n">action</span><span class="o">=</span><span class="n">_EncodeReasonAction</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;reason&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify reason for revoking certificate. (default: unspecified)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;revoke&quot;</span><span class="p">,</span>
                <span class="s2">&quot;--delete-after-revoke&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;delete_after_revoke&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Delete certificates after revoking them, along with all previous and later &quot;</span>
                <span class="s2">&quot;versions of those certificates.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;revoke&quot;</span><span class="p">,</span>
                <span class="s2">&quot;--no-delete-after-revoke&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span>
                <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;delete_after_revoke&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;delete_after_revoke&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not delete certificates after revoking them. This &quot;</span>
                     <span class="s2">&quot;option should be used with caution because the &#39;renew&#39; &quot;</span>
                     <span class="s2">&quot;subcommand will attempt to renew undeleted revoked &quot;</span>
                     <span class="s2">&quot;certificates.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;rollback&quot;</span><span class="p">,</span>
                <span class="s2">&quot;--checkpoints&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;rollback_checkpoints&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Revert configuration N number of checkpoints.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span>
                <span class="s2">&quot;--init&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Initialize plugins.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span>
                <span class="s2">&quot;--prepare&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;prepare&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Initialize and prepare plugins.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span>
                <span class="s2">&quot;--authenticators&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append_const&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;ifaces&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;ifaces&quot;</span><span class="p">),</span>
                <span class="n">const</span><span class="o">=</span><span class="n">interfaces</span><span class="o">.</span><span class="n">IAuthenticator</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Limit to authenticator plugins only.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span>
                <span class="s2">&quot;--installers&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append_const&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;ifaces&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;ifaces&quot;</span><span class="p">),</span>
                <span class="n">const</span><span class="o">=</span><span class="n">interfaces</span><span class="o">.</span><span class="n">IInstaller</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Limit to installer plugins only.&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="CaseInsensitiveList"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.CaseInsensitiveList">[docs]</a><span class="k">class</span> <span class="nc">CaseInsensitiveList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A list that will ignore case when searching.</span>

<span class="sd">    This class is passed to the `choices` argument of `argparse.add_arguments`</span>
<span class="sd">    through the `helpful` wrapper. It is necessary due to special handling of</span>
<span class="sd">    command line arguments by `set_by_cli` in which the `type_func` is not applied.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CaseInsensitiveList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span></div>


<span class="k">def</span> <span class="nf">_paths_parser</span><span class="p">(</span><span class="n">helpful</span><span class="p">):</span>
    <span class="n">add</span> <span class="o">=</span> <span class="n">helpful</span><span class="o">.</span><span class="n">add</span>
    <span class="n">verb</span> <span class="o">=</span> <span class="n">helpful</span><span class="o">.</span><span class="n">verb</span>
    <span class="k">if</span> <span class="n">verb</span> <span class="o">==</span> <span class="s2">&quot;help&quot;</span><span class="p">:</span>
        <span class="n">verb</span> <span class="o">=</span> <span class="n">helpful</span><span class="o">.</span><span class="n">help_arg</span>

    <span class="n">cph</span> <span class="o">=</span> <span class="s2">&quot;Path to where certificate is saved (with auth --csr), installed from, or revoked.&quot;</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="s2">&quot;install&quot;</span><span class="p">,</span> <span class="s2">&quot;revoke&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;manage&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">verb</span> <span class="o">==</span> <span class="s2">&quot;certonly&quot;</span><span class="p">:</span>
        <span class="n">add</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="s2">&quot;--cert-path&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;auth_cert_path&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="n">cph</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">verb</span> <span class="o">==</span> <span class="s2">&quot;revoke&quot;</span><span class="p">:</span>
        <span class="n">add</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="s2">&quot;--cert-path&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">read_file</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">cph</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">add</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="s2">&quot;--cert-path&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">cph</span><span class="p">)</span>

    <span class="n">section</span> <span class="o">=</span> <span class="s2">&quot;paths&quot;</span>
    <span class="k">if</span> <span class="n">verb</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">,</span> <span class="s2">&quot;revoke&quot;</span><span class="p">):</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">verb</span>
    <span class="c1"># revoke --key-path reads a file, install --key-path takes a string</span>
    <span class="n">add</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s2">&quot;--key-path&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="p">((</span><span class="n">verb</span> <span class="o">==</span> <span class="s2">&quot;revoke&quot;</span> <span class="ow">and</span> <span class="n">read_file</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to private key for certificate installation &quot;</span>
             <span class="s2">&quot;or revocation (if account key is missing)&quot;</span><span class="p">)</span>

    <span class="n">default_cp</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">verb</span> <span class="o">==</span> <span class="s2">&quot;certonly&quot;</span><span class="p">:</span>
        <span class="n">default_cp</span> <span class="o">=</span> <span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;auth_chain_path&quot;</span><span class="p">)</span>
    <span class="n">add</span><span class="p">([</span><span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="s2">&quot;install&quot;</span><span class="p">],</span> <span class="s2">&quot;--fullchain-path&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default_cp</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Accompanying path to a full certificate chain (certificate plus chain).&quot;</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="s2">&quot;--chain-path&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default_cp</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Accompanying path to a certificate chain.&quot;</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="s2">&quot;--config-dir&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;config_dir&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="n">config_help</span><span class="p">(</span><span class="s2">&quot;config_dir&quot;</span><span class="p">))</span>
    <span class="n">add</span><span class="p">(</span><span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="s2">&quot;--work-dir&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;work_dir&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="n">config_help</span><span class="p">(</span><span class="s2">&quot;work_dir&quot;</span><span class="p">))</span>
    <span class="n">add</span><span class="p">(</span><span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="s2">&quot;--logs-dir&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;logs_dir&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Logs directory.&quot;</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="s2">&quot;paths&quot;</span><span class="p">,</span> <span class="s2">&quot;--server&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;server&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="n">config_help</span><span class="p">(</span><span class="s2">&quot;server&quot;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_plugins_parsing</span><span class="p">(</span><span class="n">helpful</span><span class="p">,</span> <span class="n">plugins</span><span class="p">):</span>
    <span class="c1"># It&#39;s nuts, but there are two &quot;plugins&quot; topics.  Somehow this works</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span>
        <span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Plugin Selection: Certbot client supports an &quot;</span>
        <span class="s2">&quot;extensible plugins architecture. See &#39;</span><span class="si">%(prog)s</span><span class="s2"> plugins&#39; for a &quot;</span>
        <span class="s2">&quot;list of all installed plugins and their names. You can force &quot;</span>
        <span class="s2">&quot;a particular plugin by setting options provided below. Running &quot;</span>
        <span class="s2">&quot;--help &lt;plugin_name&gt; will list flags specific to that plugin.&quot;</span><span class="p">)</span>

    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;--configurator&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;configurator&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of the plugin that is both an authenticator and an installer.&quot;</span>
                <span class="s2">&quot; Should not be used together with --authenticator or --installer. &quot;</span>
                <span class="s2">&quot;(default: Ask)&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;-a&quot;</span><span class="p">,</span> <span class="s2">&quot;--authenticator&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;authenticator&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Authenticator plugin name.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="s2">&quot;--installer&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;installer&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Installer plugin name (also used to find domains).&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;install&quot;</span><span class="p">],</span>
                <span class="s2">&quot;--apache&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;apache&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Obtain and install certificates using Apache&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;install&quot;</span><span class="p">],</span>
                <span class="s2">&quot;--nginx&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;nginx&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Obtain and install certificates using Nginx&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--standalone&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;standalone&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Obtain certificates using a &quot;standalone&quot; webserver.&#39;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--manual&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;manual&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Provide laborious manual instructions for obtaining a certificate&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--webroot&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;webroot&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Obtain certificates by placing files in a webroot directory.&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-cloudflare&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_cloudflare&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record (if you are &quot;</span>
                      <span class="s2">&quot;using Cloudflare for DNS).&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-cloudxns&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_cloudxns&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record (if you are &quot;</span>
                     <span class="s2">&quot;using CloudXNS for DNS).&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-digitalocean&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_digitalocean&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record (if you are &quot;</span>
                      <span class="s2">&quot;using DigitalOcean for DNS).&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-dnsimple&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_dnsimple&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record (if you are &quot;</span>
                      <span class="s2">&quot;using DNSimple for DNS).&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-dnsmadeeasy&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_dnsmadeeasy&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record (if you are &quot;</span>
                      <span class="s2">&quot;using DNS Made Easy for DNS).&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-gehirn&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_gehirn&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record &quot;</span>
                     <span class="s2">&quot;(if you are using Gehirn Infrastracture Service for DNS).&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-google&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_google&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record (if you are &quot;</span>
                      <span class="s2">&quot;using Google Cloud DNS).&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-linode&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_linode&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record (if you are &quot;</span>
                      <span class="s2">&quot;using Linode for DNS).&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-luadns&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_luadns&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record (if you are &quot;</span>
                      <span class="s2">&quot;using LuaDNS for DNS).&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-nsone&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_nsone&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record (if you are &quot;</span>
                      <span class="s2">&quot;using NS1 for DNS).&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-ovh&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_ovh&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record (if you are &quot;</span>
                      <span class="s2">&quot;using OVH for DNS).&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-rfc2136&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_rfc2136&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Obtain certificates using a DNS TXT record (if you are using BIND for DNS).&quot;</span><span class="p">)</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-route53&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_route53&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record (if you are using Route53 for &quot;</span>
                      <span class="s2">&quot;DNS).&quot;</span><span class="p">))</span>
    <span class="n">helpful</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span> <span class="s2">&quot;certonly&quot;</span><span class="p">],</span> <span class="s2">&quot;--dns-sakuracloud&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">flag_default</span><span class="p">(</span><span class="s2">&quot;dns_sakuracloud&quot;</span><span class="p">),</span>
                <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Obtain certificates using a DNS TXT record &quot;</span>
                     <span class="s2">&quot;(if you are using Sakura Cloud for DNS).&quot;</span><span class="p">))</span>

    <span class="c1"># things should not be reorder past/pre this comment:</span>
    <span class="c1"># plugins_group should be displayed in --help before plugin</span>
    <span class="c1"># specific groups (so that plugins_group.description makes sense)</span>

    <span class="n">helpful</span><span class="o">.</span><span class="n">add_plugin_args</span><span class="p">(</span><span class="n">plugins</span><span class="p">)</span>


<div class="viewcode-block" id="_EncodeReasonAction"><a class="viewcode-back" href="../../api/cli.html#certbot.cli._EncodeReasonAction">[docs]</a><span class="k">class</span> <span class="nc">_EncodeReasonAction</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">Action</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Action class for parsing revocation reason.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">reason</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Encodes the reason for certificate revocation.&quot;&quot;&quot;</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">REVOCATION_REASONS</span><span class="p">[</span><span class="n">reason</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span></div>


<div class="viewcode-block" id="_DomainsAction"><a class="viewcode-back" href="../../api/cli.html#certbot.cli._DomainsAction">[docs]</a><span class="k">class</span> <span class="nc">_DomainsAction</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">Action</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Action class for parsing domains.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Just wrap add_domains in argparseese.&quot;&quot;&quot;</span>
        <span class="n">add_domains</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span></div>

<div class="viewcode-block" id="add_domains"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.add_domains">[docs]</a><span class="k">def</span> <span class="nf">add_domains</span><span class="p">(</span><span class="n">args_or_config</span><span class="p">,</span> <span class="n">domains</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Registers new domains to be used during the current client run.</span>

<span class="sd">    Domains are not added to the list of requested domains if they have</span>
<span class="sd">    already been registered.</span>

<span class="sd">    :param args_or_config: parsed command line arguments</span>
<span class="sd">    :type args_or_config: argparse.Namespace or</span>
<span class="sd">        configuration.NamespaceConfig</span>
<span class="sd">    :param str domain: one or more comma separated domains</span>

<span class="sd">    :returns: domains after they have been normalized and validated</span>
<span class="sd">    :rtype: `list` of `str`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">validated_domains</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">domains</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">enforce_domain_sanity</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">validated_domains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args_or_config</span><span class="o">.</span><span class="n">domains</span><span class="p">:</span>
            <span class="n">args_or_config</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">validated_domains</span></div>

<div class="viewcode-block" id="_PrefChallAction"><a class="viewcode-back" href="../../api/cli.html#certbot.cli._PrefChallAction">[docs]</a><span class="k">class</span> <span class="nc">_PrefChallAction</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">Action</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Action class for parsing preferred challenges.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">pref_challs</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">challs</span> <span class="o">=</span> <span class="n">parse_preferred_challenges</span><span class="p">(</span><span class="n">pref_challs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="n">namespace</span><span class="o">.</span><span class="n">pref_challs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">challs</span><span class="p">)</span></div>


<div class="viewcode-block" id="parse_preferred_challenges"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.parse_preferred_challenges">[docs]</a><span class="k">def</span> <span class="nf">parse_preferred_challenges</span><span class="p">(</span><span class="n">pref_challs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Translate and validate preferred challenges.</span>

<span class="sd">    :param pref_challs: list of preferred challenge types</span>
<span class="sd">    :type pref_challs: `list` of `str`</span>

<span class="sd">    :returns: validated list of preferred challenge types</span>
<span class="sd">    :rtype: `list` of `str`</span>

<span class="sd">    :raises errors.Error: if pref_challs is invalid</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dns&quot;</span><span class="p">:</span> <span class="s2">&quot;dns-01&quot;</span><span class="p">,</span> <span class="s2">&quot;http&quot;</span><span class="p">:</span> <span class="s2">&quot;http-01&quot;</span><span class="p">,</span> <span class="s2">&quot;tls-sni&quot;</span><span class="p">:</span> <span class="s2">&quot;tls-sni-01&quot;</span><span class="p">}</span>
    <span class="n">challs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pref_challs</span><span class="p">]</span>
    <span class="n">challs</span> <span class="o">=</span> <span class="p">[</span><span class="n">aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">challs</span><span class="p">]</span>

    <span class="c1"># Ignore tls-sni-01 from the list, and generates a deprecation warning</span>
    <span class="c1"># TODO: remove this option completely in few releases</span>
    <span class="k">if</span> <span class="s2">&quot;tls-sni-01&quot;</span> <span class="ow">in</span> <span class="n">challs</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;TLS-SNI-01 support is deprecated. This value is being dropped from the &#39;</span>
                       <span class="s1">&#39;setting of --preferred-challenges and future versions of Certbot will &#39;</span>
                       <span class="s1">&#39;error if it is included.&#39;</span><span class="p">)</span>
        <span class="n">challs</span> <span class="o">=</span> <span class="p">[</span><span class="n">chall</span> <span class="k">for</span> <span class="n">chall</span> <span class="ow">in</span> <span class="n">challs</span> <span class="k">if</span> <span class="n">chall</span> <span class="o">!=</span> <span class="s2">&quot;tls-sni-01&quot;</span><span class="p">]</span>

    <span class="n">unrecognized</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">challs</span>
                             <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">challenges</span><span class="o">.</span><span class="n">Challenge</span><span class="o">.</span><span class="n">TYPES</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unrecognized</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span>
            <span class="s2">&quot;Unrecognized challenges: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unrecognized</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">challs</span></div>


<span class="k">def</span> <span class="nf">_user_agent_comment_type</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">or</span> <span class="s2">&quot;)&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentTypeError</span><span class="p">(</span><span class="s2">&quot;may not contain parentheses&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>


<div class="viewcode-block" id="_DeployHookAction"><a class="viewcode-back" href="../../api/cli.html#certbot.cli._DeployHookAction">[docs]</a><span class="k">class</span> <span class="nc">_DeployHookAction</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">Action</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Action class for parsing deploy hooks.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">renew_hook_set</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">deploy_hook</span> <span class="o">!=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">renew_hook</span>
        <span class="k">if</span> <span class="n">renew_hook_set</span> <span class="ow">and</span> <span class="n">namespace</span><span class="o">.</span><span class="n">renew_hook</span> <span class="o">!=</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;conflicts with --renew-hook value&quot;</span><span class="p">)</span>
        <span class="n">namespace</span><span class="o">.</span><span class="n">deploy_hook</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">renew_hook</span> <span class="o">=</span> <span class="n">values</span></div>


<div class="viewcode-block" id="_RenewHookAction"><a class="viewcode-back" href="../../api/cli.html#certbot.cli._RenewHookAction">[docs]</a><span class="k">class</span> <span class="nc">_RenewHookAction</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">Action</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Action class for parsing renew hooks.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">deploy_hook_set</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">deploy_hook</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">deploy_hook_set</span> <span class="ow">and</span> <span class="n">namespace</span><span class="o">.</span><span class="n">deploy_hook</span> <span class="o">!=</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;conflicts with --deploy-hook value&quot;</span><span class="p">)</span>
        <span class="n">namespace</span><span class="o">.</span><span class="n">renew_hook</span> <span class="o">=</span> <span class="n">values</span></div>


<div class="viewcode-block" id="nonnegative_int"><a class="viewcode-back" href="../../api/cli.html#certbot.cli.nonnegative_int">[docs]</a><span class="k">def</span> <span class="nf">nonnegative_int</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts value to an int and checks that it is not negative.</span>

<span class="sd">    This function should used as the type parameter for argparse</span>
<span class="sd">    arguments.</span>

<span class="sd">    :param str value: value provided on the command line</span>

<span class="sd">    :returns: integer representation of value</span>
<span class="sd">    :rtype: int</span>

<span class="sd">    :raises argparse.ArgumentTypeError: if value isn&#39;t a non-negative integer</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">int_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentTypeError</span><span class="p">(</span><span class="s2">&quot;value must be an integer&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">int_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentTypeError</span><span class="p">(</span><span class="s2">&quot;value must be non-negative&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">int_value</span></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <span class="copyright">
    &copy; Copyright 2014-2018 - The Certbot software and documentation are licensed under the Apache 2.0 license as described at <a href="https://eff.org/cb-license">https://eff.org/cb-license</a>.
    </span>
    <br>
    <br>
    <span class="status">
        <a href="https://letsencrypt.status.io/">Let's Encrypt Status</a>
    </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Other Versions</span>
      v: 
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Downloads</dt>
        <dd><a href="../../certbot.pdf">PDF</a></dd>
        <dd><a href="../../certbot.zip">HTML</a></dd>
        <dd><a href="../../certbot.epub">Epub</a></dd>
      </dl>
      <hr/>

    </div>
  </div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.37.0.dev0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

<noscript><img src="https://anon-stats.eff.org/piwik.php?idsite=24&amp;rec=1&amp;action_name=certbot.cli%E2%80%94%20Certbot%200.37.0.dev0%20documentation" style="border:0" height="0" width="0" alt="" /></noscript>
<div style="height: 0; width: 0; position: absolute" id="anon-stats"></div>
<script type="text/javascript">
document.getElementById('anon-stats').innerHTML = '<img src="https://anon-stats.eff.org/piwik.php?idsite=24&amp;rec=1&amp;urlref=' + encodeURIComponent(document.referrer) + '&amp;action_name=' + encodeURIComponent(document.title) + '" style="border:0" height="0" width="0" alt="" />';
</script>
</body>
</html>